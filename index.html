<!DOCTYPE html>
<html>
<head>
  <title>WebSocket Client</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background-color: #191919;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    
    th, td {
      text-align: left;
      padding: 8px;
    }
    
    th {
      background-color: #4CAF50;
      color: white;
    }
    
    tr:nth-child(even) {
      background-color: rgba(255, 255, 255, 0.133);
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    const ws = new WebSocket('ws://arqui-production.up.railway.app:443');
    let airQualityChart;
    let temperatureChart;
    let pressureChart;
    let altitudeChart;

    ws.onopen = function () {
      console.log('Conexi칩n establecida con el servidor de WebSocket');
    };

    ws.onmessage = function (event) {
      const data = JSON.parse(event.data);
   

      // Actualizar las gr치ficas con los nuevos datos
      updateChart(airQualityChart, data.air_quality);
      updateChart(temperatureChart, data.temperature);
      updateChart(pressureChart, data.pressure);
      updateChart(altitudeChart, data.altitude);
    };

    function createChart(containerId, label, backgroundColor, borderColor) {
      const container = document.getElementById(containerId);
      const canvas = document.createElement('canvas');
      container.appendChild(canvas);

      const ctx = canvas.getContext('2d');
      const chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [
            {
              label: label,
              data: [],
              backgroundColor: backgroundColor,
              borderColor: borderColor,
              borderWidth: 1,
              fill: 'start'
            }
          ]
        },
        options: {
          animations: {
      tension: {
        duration: 1000,
        easing: 'linear',
        from: 1,
        to: 0,
        loop: true
      }
    },

          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              display: true
            },
            y: {
              display: true,
              beginAtZero: true
            }
          }
        }
      });

      return chart;
    }

    function updateChart(chart, newData) {
      chart.data.labels.push('');
      chart.data.datasets[0].data.push(newData);
      chart.update();
    }

    // Crear gr치ficas independientes
    document.addEventListener('DOMContentLoaded', function () {
      airQualityChart = createChart('air-quality-chart', 'Calidad del aire (PPM)', 'rgba(0, 123, 255, 0.5)', 'rgba(0, 123, 255, 1)');
      temperatureChart = createChart('temperature-chart', 'Temperatura (C)', 'rgba(255, 99, 132, 0.5)', 'rgba(255, 99, 132, 1)');
      pressureChart = createChart('pressure-chart', 'Presi칩n (hPa)', 'rgba(75, 192, 192, 0.5)', 'rgba(75, 192, 192, 1)');
      altitudeChart = createChart('altitude-chart', 'Altura (M)', 'rgba(255, 205, 86, 0.5)', 'rgba(255, 205, 86, 1)');
    });

  </script>
</head>
<body>
  <div id="air-quality-chart"></div>

  <div id="temperature-chart"></div>
  <div id="pressure-chart"></div>
  <div id="altitude-chart"></div>
</body>
</html>
